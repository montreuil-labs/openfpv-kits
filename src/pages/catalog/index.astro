---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCatalogList } from '../../lib/data';

const items = getCatalogList();
const grouped = items.reduce<Record<string, typeof items>>((acc, item) => {
  (acc[item.type] = acc[item.type] || []).push(item);
  return acc;
}, {});
const types = Object.keys(grouped).sort();
const formatRange = (values: [number, number]) => `$${Math.round(values[0])} â€“ $${Math.round(values[1])}`;
---

<BaseLayout title="Catalog | OpenFPV Kits" description="Reusable catalog items for kits and the builder.">
  <div class="section-title">
    <div>
      <h2>Catalog</h2>
      <p class="muted">Reusable items that kits reference. Edit in GitHub or suggest new ones.</p>
    </div>
    <a
      class="btn secondary"
      href="https://github.com/montreuil-labs/openfpv-kits/new/main/src/data/catalog/items?filename=new-item.yml&value=%23%20Add%20a%20new%20catalog%20item.%20Remove%20comments%20before%20committing.%0A%23%20Required%3A%20id%2C%20type%2C%20title%2C%20summary%2C%20price.typical_range.%0A%23%20Types%3A%20radio%20%7C%20goggles%20%7C%20drone%20%7C%20battery%20%7C%20charger%20%7C%20accessory%20%7C%20simulator%0Aid%3A%20your-item-id%0Atype%3A%20radio%0Abrand%3A%20%22%22%0Amodel%3A%20%22%22%0Atitle%3A%20%22Item%20title%22%0Asummary%3A%20%22One-line%20summary.%22%0Atags%3A%0A%20%20-%20beginner%0Aprice%3A%0A%20%20currency%3A%20USD%0A%20%20typical_range%3A%20%5B0%2C%200%5D%0A%20%20note%3A%20%22%22%0Alinks%3A%0A%20%20official%3A%20%22%22%0A%20%20search%3A%20%22%22%0Arequires%3A%20%5B%5D%0Aincludes%3A%20%5B%5D%0Abattery_options%3A%20%5B%5D%0Apower_options%3A%20%5B%5D%0Aalso_see%3A%20%5B%5D%0A"
      target="_blank"
    >
      Add catalog item
    </a>
  </div>

  {types.map((type) => (
    <section class="mb-6" id={type}>
      <div class="mb-2 flex items-center justify-between">
        <h3 class="text-lg font-semibold capitalize">{type}</h3>
        <a class="btn secondary" href={`#${type}`}>Link</a>
      </div>
      <div class="grid-responsive">
        {grouped[type].map((item) => (
          <article class="card space-y-2">
            <div class="flex items-start justify-between gap-3">
              <div>
                <h4 class="font-semibold">{item.title}</h4>
                <p class="text-sm text-[--color-muted]">{item.summary}</p>
              </div>
              <p class="text-sm font-semibold">{formatRange(item.price.typical_range)}</p>
            </div>
            <div class="flex flex-wrap gap-1 text-xs text-[--color-muted]">
              {item.tags.slice(0, 4).map((tag) => (
                <span class="badge">{tag}</span>
              ))}
            </div>
            <div class="flex flex-wrap gap-2">
              <a class="btn" href={`/catalog/${item.id}`}>Open</a>
    <a
      class="btn secondary"
      href="https://github.com/montreuil-labs/openfpv-kits/new/main/src/data/catalog/items?filename=new-item.yml&value=%23%20Add%20a%20new%20catalog%20item.%20Remove%20comments%20before%20committing.%0A%23%20Guide%3A%20https%3A%2F%2Fgithub.com%2Fmontreuil-labs%2Fopenfpv-kits%2Fblob%2Fmain%2Fdocs%2Fadd-catalog-item.md%0Aid%3A%20your-item-id%0Atype%3A%20radio%20%23%20Types%3A%20radio%20%7C%20goggles%20%7C%20drone%20%7C%20battery%20%7C%20charger%20%7C%20accessory%20%7C%20simulator%0Abrand%3A%20%22%22%0Amodel%3A%20%22%22%0Atitle%3A%20%22Item%20title%22%0Asummary%3A%20%22One-line%20summary.%22%0Atags%3A%0A%20%20-%20beginner%0Aprice%3A%0A%20%20currency%3A%20USD%0A%20%20typical_range%3A%20%5B0%2C%200%5D%0A%20%20note%3A%20%22%22%0Alinks%3A%0A%20%20official%3A%20%22%22%0A%20%20search%3A%20%22%22%0Arequires%3A%20%5B%5D%20%23%20list%20of%20%7Bkind%2Ctitle%2Cqty%3F%2Cnotes%3F%7D%0Aincludes%3A%20%5B%5D%20%23%20same%20shape%20as%20requires%3B%20optional%0Abattery_options%3A%20%5B%5D%20%23%20e.g.%20%5B%7Btitle%3A%20%22%22%2C%20typical_range_usd%3A%20%5B0%2C0%5D%2C%20notes%3A%20%22%22%7D%5D%0Apower_options%3A%20%5B%5D%0Aalso_see%3A%20%5B%5D%20%23%20other%20item%20ids%0A"
      target="_blank"
    >
      Add catalog item
    </a>

            </div>
          </article>
        ))}
      </div>
    </section>
  ))}
</BaseLayout>
