---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCatalogList } from '../../lib/data';

const items = getCatalogList();
const grouped = items.reduce<Record<string, typeof items>>((acc, item) => {
  (acc[item.type] = acc[item.type] || []).push(item);
  return acc;
}, {});
const types = Object.keys(grouped).sort();
const formatRange = (values: [number, number]) => `$${Math.round(values[0])} â€“ $${Math.round(values[1])}`;
---

<BaseLayout title="Catalog | OpenFPV Kits" description="Reusable catalog items for kits and the builder.">
  <div class="section-title">
    <div>
      <h2>Catalog</h2>
      <p class="muted">Reusable items that kits reference. Edit in GitHub or suggest new ones.</p>
    </div>
    <a
      class="btn secondary"
      href="https://github.com/montreuil-labs/openfpv-kits/issues/new?title=Catalog%20suggestion"
      target="_blank"
    >
      Suggest item
    </a>
  </div>

  {types.map((type) => (
    <section class="mb-6" id={type}>
      <div class="mb-2 flex items-center justify-between">
        <h3 class="text-lg font-semibold capitalize">{type}</h3>
        <a class="btn secondary" href={`#${type}`}>Link</a>
      </div>
      <div class="grid-responsive">
        {grouped[type].map((item) => (
          <article class="card space-y-2">
            <div class="flex items-start justify-between gap-3">
              <div>
                <h4 class="font-semibold">{item.title}</h4>
                <p class="text-sm text-[--color-muted]">{item.summary}</p>
              </div>
              <p class="text-sm font-semibold">{formatRange(item.price.typical_range)}</p>
            </div>
            <div class="flex flex-wrap gap-1 text-xs text-[--color-muted]">
              {item.tags.slice(0, 4).map((tag) => (
                <span class="badge">{tag}</span>
              ))}
            </div>
            <div class="flex flex-wrap gap-2">
              <a class="btn" href={`/catalog/${item.id}`}>Open</a>
              <a
                class="btn secondary"
                href={`https://github.com/montreuil-labs/openfpv-kits/edit/main/src/data/catalog/items/${item.id}.yml`}
                target="_blank"
              >
                Edit
              </a>
            </div>
          </article>
        ))}
      </div>
    </section>
  ))}
</BaseLayout>
